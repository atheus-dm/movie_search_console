from typing import List, Dict, Optional
import re


def prompt_valid_year(prompt_text: str, year_from: int, year_to: int) -> int:
    """
        –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–≤–æ–¥ –≥–æ–¥–∞, –ø—Ä–æ–≤–µ—Ä—è—è, —á—Ç–æ —ç—Ç–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ,
        –Ω–∞—Ö–æ–¥—è—â–µ–µ—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ `year_from` –∏ `year_to`.

        –§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ñ–∏–ª—å–º–æ–≤ –ø–æ –≥–æ–¥—É –≤—ã–ø—É—Å–∫–∞ (–≤ —Ä–µ–∂–∏–º–µ –ø–æ–∏—Å–∫–∞ –ø–æ –∂–∞–Ω—Ä—É –∏ –≥–æ–¥—É).
        –î–∏–∞–ø–∞–∑–æ–Ω –≤–∞–ª–∏–¥–Ω—ã—Ö –ª–µ—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`film.release_year`) —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é
        `mysql_connector.get_year_range()` –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤—ã–∑—ã–≤–∞—é—â–∏–º –∫–æ–¥–æ–º.

        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
        ----------
        prompt_text : str
            –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏ –≤–≤–æ–¥–µ.
            –ù–∞–ø—Ä–∏–º–µ—Ä: "üìÖ –í–≤–µ–¥–∏—Ç–µ –≥–æ–¥ –û–¢ (1990 ‚Äì 2025):"

        year_from : int
            –ù–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –≥–æ–¥–∞ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ).
            –û–±—ã—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é `release_year` –≤ —Ç–∞–±–ª–∏—Ü–µ `film`.

        year_to : int
            –í–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –≥–æ–¥–∞ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ).
            –û–±—ã—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é `release_year` –≤ —Ç–∞–±–ª–∏—Ü–µ `film`.

        –ü–æ–≤–µ–¥–µ–Ω–∏–µ:
        ----------
        - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª `while True`.
        - –ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –≤–≤–æ–¥ –∑–Ω–∞—á–µ–Ω–∏—è (`input(prompt_text)`).
        - –°—Ç—Ä–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –º–µ—Ç–æ–¥–æ–º `.isdigit()`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ —Ç–æ–º, —á—Ç–æ –æ–Ω–∞ —Å–æ—Å—Ç–æ–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑ —Ü–∏—Ñ—Ä.
            ‚Üí –ò—Å–∫–ª—é—á–∞—é—Ç—Å—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, –¥—Ä–æ–±–Ω—ã–µ —á–∏—Å–ª–∞, —Å–∏–º–≤–æ–ª—ã –∏ –ø—Ä–æ–±–µ–ª—ã.
        - –ü–æ—Å–ª–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ `int` ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω—É [year_from, year_to].
        - –ï—Å–ª–∏ –≥–æ–¥ –≤–∞–ª–∏–¥–µ–Ω ‚Äî –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
        - –í —Å–ª—É—á–∞–µ –ª—é–±–æ–π –æ—à–∏–±–∫–∏ (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–ª–∏ –≤—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã) ‚Äî –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ,
          –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–≤–æ–¥.

        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        -----------
        int
            –ß–∏—Å–ª–æ, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–µ–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞ –∏–∑ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞.

        –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
        -----------
        –ù–µ –≤–æ–∑–±—É–∂–¥–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –æ—à–∏–±–∫–∏ –≤–≤–æ–¥–∞ —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.
        –í—ã—Ö–æ–¥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `return`, –ø—Ä–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
        """
    while True:
        year = input(prompt_text)
        if year.isdigit():
            year_int = int(year)
            if year_from <= year_int <= year_to:
                return year_int
        print(f"‚ö† –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ–¥ ({year_from}‚Äì{year_to})")


def prompt_next_page() -> str:
    """
    –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–∞–Ω–Ω—ã—Ö ‚Äî
    –æ–∂–∏–¥–∞–µ—Ç—Å—è –≤–≤–æ–¥ –æ–¥–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞: 'y' (yes ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å) –∏–ª–∏ 'n' (no ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è).

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
    -----------
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
        - –í `ui_controller.handle_keyword_search()` ‚Äî –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–ª–µ–¥—É—é—â–∏—Ö 10 —Ñ–∏–ª—å–º–æ–≤ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É.
        - –í `handle_genre_year_search()` ‚Äî –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø–æ–∏—Å–∫–∞ –ø–æ –∂–∞–Ω—Ä–∞–º –∏ –≥–æ–¥—É.
    –§—É–Ω–∫—Ü–∏—è –¥–µ–π—Å—Ç–≤—É–µ—Ç –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.

    –ü–æ–≤–µ–¥–µ–Ω–∏–µ:
    ----------
    - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ü–∏–∫–ª `while True`, –æ–∂–∏–¥–∞—é—â–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–≤–æ–¥ –ª–∏–±–æ "y", –ª–∏–±–æ "n".
    - –í–≤–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥–æ–º `.strip().lower()`, —á—Ç–æ–±—ã:
        * —É–¥–∞–ª–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –∏ –∫–æ–Ω–µ—á–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã;
        * –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤–≤–æ–¥ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É (—É—Å—Ç–æ–π—á–∏–≤–æ –∫ "Y", " N", " y " –∏ —Ç.–ø.).
    - –ï—Å–ª–∏ –≤–≤–µ–¥—ë–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª ‚Äî –¥–æ–ø—É—Å—Ç–∏–º—ã–π ('y' –∏–ª–∏ 'n'), –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
    - –ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ —á—Ç–æ-–ª–∏–±–æ –¥—Ä—É–≥–æ–µ ‚Äî –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ –≤–≤–æ–¥ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è.

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    -----------
    str
        –°–∏–º–≤–æ–ª 'y' ‚Äî –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É,
        –ª–∏–±–æ 'n' ‚Äî –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä.

    –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
    -----------
    –ù–µ –≤–æ–∑–±—É–∂–¥–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π. –í—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
    """
    while True:
        response = input("üëâ –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ 10? (y/n): ").strip().lower()
        if response in ("y", "n"):
            return response
        print("‚ö† –í–≤–µ–¥–∏—Ç–µ y –∏–ª–∏ n.")


def select_genres(genres_map: List[Dict]) -> List[str]:
    """
    –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∂–∞–Ω—Ä–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ñ–∏–ª—å–º–∞–º,
    –≤–≤–æ–¥—è –∏—Ö —á–∏—Å–ª–æ–≤—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∂–∞–Ω—Ä–æ–≤.

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
    -----------
    –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ `ui_controller.handle_genre_year_search()` –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ñ–∏–ª—å–º–æ–≤
    –ø–æ –∂–∞–Ω—Ä–∞–º. –°–ø–∏—Å–æ–∫ `genres_map` –∑–∞—Ä–∞–Ω–µ–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π `get_genres_with_ids()`
    –∏–∑ –º–æ–¥—É–ª—è `mysql_connector`, –∫–æ—Ç–æ—Ä–∞—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–∞—Ä—ã (category_id, name) –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
    –∂–∞–Ω—Ä–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
    ----------
    genres_map : List[Dict]
        –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π, –≥–¥–µ –∫–∞–∂–¥—ã–π —Å–ª–æ–≤–∞—Ä—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∂–∞–Ω—Ä –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—è:
            - category_id : int  ‚Äî —á–∏—Å–ª–æ–≤–æ–π ID –∂–∞–Ω—Ä–∞
            - name        : str  ‚Äî —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä–∞

    –ü–æ–≤–µ–¥–µ–Ω–∏–µ:
    ----------
    - –°–Ω–∞—á–∞–ª–∞ –∏–∑ `genres_map` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ `valid_ids` ‚Äî –≤—Å–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ ID –∂–∞–Ω—Ä–æ–≤.
    - –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–≤–æ–¥ —á–µ—Ä–µ–∑ `input()`:
        ‚Üí –ü—Ä–∏–º–µ—Ä: "üé≠ –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä–∞ –∂–∞–Ω—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–∏–ª–∏ 0 –¥–ª—è –≤—Å–µ—Ö):"
    - –°—Ç—Ä–æ–∫–∞, –≤–≤–µ–¥—ë–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –ø–æ –∑–∞–ø—è—Ç–æ–π –∏ –æ—á–∏—â–∞–µ—Ç—Å—è:
        * –∫–∞–∂–¥–∞—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ `int`
        * –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `try/except` ‚Äî –æ—Ç–ª–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è ValueError, –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Ü–∏—Ñ—Ä—ã
    - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª —Ä–æ–≤–Ω–æ `0`, —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–≤—Å–µ –∂–∞–Ω—Ä—ã**:
        `[g["name"] for g in genres_map]`
    - –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ:
        * –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –≤—Å–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–µ ID –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ `valid_ids`
        * –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π ID ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ, –ø–æ–≤—Ç–æ—Ä –≤–≤–æ–¥–∞
    - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ `name` –∂–∞–Ω—Ä–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–≤–µ–¥—ë–Ω–Ω—ã–º `category_id`.

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    -----------
    List[str]
        –°–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π –∂–∞–Ω—Ä–æ–≤, –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

    –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
    -----------
    –û—à–∏–±–∫–∏ –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ ID, –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é,
    –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –≤–æ–∑–±—É–∂–¥–∞—é—Ç—Å—è. –ü–æ–≤—Ç–æ—Ä –≤–≤–æ–¥–∞ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ü–∏–∫–ª.

    –ì–∞—Ä–∞–Ω—Ç–∏–∏:
    ---------
    - –í—Å–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∂–∞–Ω—Ä—ã –≤–∞–ª–∏–¥–Ω—ã –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –∏—Å—Ö–æ–¥–Ω–æ–º `genres_map`.
    - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç "0", –≤–æ–∑–≤—Ä–∞—Ç –≤–∫–ª—é—á–∞–µ—Ç **–≤—Å–µ –∂–∞–Ω—Ä—ã**, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞.
    - –ù–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ `None` ‚Äî –≤—Å–µ–≥–¥–∞ –ª–∏–±–æ —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤, –ª–∏–±–æ –ø–æ–≤—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–æ –≤–∞–ª–∏–¥–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
    """
    valid_ids = {g["category_id"] for g in genres_map}

    while True:
        raw_input_genres = input("üé≠ –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä–∞ –∂–∞–Ω—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–∏–ª–∏ 0 –¥–ª—è –≤—Å–µ—Ö): ").strip()
        try:
            ids = [int(i.strip()) for i in raw_input_genres.split(",")]
        except ValueError:
            print("‚ö† –û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞. –í–≤–µ–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.")
            continue

        if ids == [0]:
            return [g["name"] for g in genres_map]

        invalid = [i for i in ids if i not in valid_ids]
        if invalid:
            print(f"‚ö† –ñ–∞–Ω—Ä —Å –Ω–æ–º–µ—Ä–æ–º {', '.join(map(str, invalid))} –Ω–µ –Ω–∞–π–¥–µ–Ω. –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫.")
            continue

        return [g["name"] for g in genres_map if g["category_id"] in ids]


def sanitize_input(text: str) -> Optional[str]:
    """
    –û—á–∏—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –æ—Ç –º—É—Å–æ—Ä–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –µ—ë –ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å
    –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –ø–æ–∏—Å–∫–æ–≤—ã–π SQL-–∑–∞–ø—Ä–æ—Å. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏–±–æ –æ—á–∏—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, –ª–∏–±–æ None, –µ—Å–ª–∏
    –≤–≤–æ–¥ —Å—á–∏—Ç–∞–µ—Ç—Å—è –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º.

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
    -----------
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `ui_controller.handle_keyword_search()` –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–≤–æ–¥–∞ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞.
    –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–∑–≤–∞–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π ‚Äî
    –∫–∞–∫ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç–∞–∫ –∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–≤ `search_engine.search_by_keyword`).

    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
    ----------
    text : str
        –ò—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –≤–≤–µ–¥—ë–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º. –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã, —Å–∏–º–≤–æ–ª—ã, –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –∏–ª–∏ —à—É–º–æ–≤—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

    –ü–æ–≤–µ–¥–µ–Ω–∏–µ:
    ----------
    1. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è `re.sub(r"[^\\w\\s\\-]", "", text)`:
        - –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–∏–º–≤–æ–ª—ã, **–Ω–µ –≤—Ö–æ–¥—è—â–∏–µ** –≤ –Ω–∞–±–æ—Ä: –±—É–∫–≤—ã (`\\w`), –ø—Ä–æ–±–µ–ª—ã (`\\s`), –¥–µ—Ñ–∏—Å—ã (`-`).
        - –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –≤—Ä–æ–¥–µ `!@#$%^&*(){}[]<>?` –∏ —Ç.–ø.
        - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ª–∞—Ç–∏–Ω–∏—Ü–∞, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞, —Ü–∏—Ñ—Ä—ã, —Å–∏–º–≤–æ–ª—ã –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è –∏ –¥–µ—Ñ–∏—Å—ã.

    2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è `.strip()`:
        - –£–¥–∞–ª—è–µ—Ç –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏, –∏—Å–∫–ª—é—á–∞—è –≤–≤–æ–¥ –≤—Ä–æ–¥–µ `"  –∫–æ–º–µ–¥–∏—è "`.

    3. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
        - –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç (`""`) –∏–ª–∏ —Å–æ—Å—Ç–æ–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤ (`.isspace()`),
          —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `None`.

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    -----------
    Optional[str]
        - –°—Ç—Ä–æ–∫–∞ —Å –æ—á–∏—â–µ–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º ‚Äî –≥–æ—Ç–æ–≤–∞—è –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–µ –≤ SQL.
        - `None`, –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è —à—É–º–æ–≤—ã–º –∏–ª–∏ –ø—É—Å—Ç—ã–º.

    –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
    -----------
    –ù–µ –≤–æ–∑–±—É–∂–¥–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –§—É–Ω–∫—Ü–∏—è –Ω–µ –¥–µ–ª–∞–µ—Ç –¥–æ–ø—É—â–µ–Ω–∏–π ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º —Ç–µ–∫—Å—Ç–æ–º
    –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏–±–æ –ø—Ä–∏–≥–æ–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É, –ª–∏–±–æ None.

    –ì–∞—Ä–∞–Ω—Ç–∏–∏:
    ---------
    - –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤, –Ω–µ –ø—Ä–∏–≥–æ–¥–Ω—ã—Ö –¥–ª—è SQL.
    - –°—Ç—Ä–æ–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ–∏—Å–∫–∞, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
    - –ù–∏–∫–∞–∫–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è ‚Äî –≤—Å—ë –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ª–æ–≥–∏–∫–∏.
    """
    cleaned = re.sub(r"[^\w\s\-]", "", text)  # –£–¥–∞–ª—è–µ–º —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –¥–µ—Ñ–∏—Å–æ–≤
    cleaned = cleaned.strip()
    if not cleaned or cleaned.isspace():
        return None
    return cleaned
