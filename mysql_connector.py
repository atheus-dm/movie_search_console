import mysql.connector
from mysql.connector import Error, MySQLConnection
from dotenv import load_dotenv
import os
from typing import List, Dict, Tuple, Any, Optional

# üõ† –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ .env
load_dotenv()


def create_connection() -> Optional[MySQLConnection]:
    """
    –°–æ–∑–¥–∞—ë—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö MySQL –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
        –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π —Å–ø–æ—Å–æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å MySQL,
        –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –º–æ–¥—É–ª—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.

    –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
        - MYSQL_HOST: –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, "localhost");
        - MYSQL_PORT: –ø–æ—Ä—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ 3306);
        - MYSQL_USER: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
        - MYSQL_PASSWORD: –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
        - MYSQL_DATABASE: –∏–º—è —Ü–µ–ª–µ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

    –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
        1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env`, –µ—Å–ª–∏ –æ–Ω–∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.
        2. –í—ã–∑—ã–≤–∞–µ—Ç `mysql.connector.connect(...)`, –ø–µ—Ä–µ–¥–∞–≤–∞—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ `os.getenv(...)`.
        3. –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `MySQLConnection`.
        4. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (`mysql.connector.Error`), –≤—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤ –∫–æ–Ω—Å–æ–ª—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`.

    –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
        Optional[MySQLConnection]:
            - –û–±—ä–µ–∫—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.
            - None, –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∏ —Ç.–¥.)."""
    try:
        return mysql.connector.connect(
            host=os.getenv("MYSQL_HOST"),
            port=int(os.getenv("MYSQL_PORT")),
            user=os.getenv("MYSQL_USER"),
            password=os.getenv("MYSQL_PASSWORD"),
            database=os.getenv("MYSQL_DATABASE")
        )
    except Error as e:
        print(f"[–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è]: {e}")
        return None


def search_by_keyword(keyword: str, offset: int = 0) -> List[Dict[str, Any]]:
    """
        –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö MySQL –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É,
        –∏—Å–ø–æ–ª—å–∑—É—è —É—Å–ª–æ–≤–∏–µ LIKE –Ω–∞ –ø–æ–ª–µ `title`. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∂–∞–Ω—Ä–∞–º–∏ –∏ –∞–∫—Ç—ë—Ä–∞–º–∏.

        –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
            –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∏–ª—å–º–∞,
            –≤–æ–∑–≤—Ä–∞—â–∞—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º —Ñ–∏–ª—å–º–µ, –≤–∫–ª—é—á–∞—è –æ–ø–∏—Å–∞–Ω–∏–µ, –≥–æ–¥, —Ä–µ–π—Ç–∏–Ω–≥, –∂–∞–Ω—Ä—ã –∏ –∞–∫—Ç—ë—Ä–æ–≤.

        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            keyword (str): –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫.
                           –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —à–∞–±–ª–æ–Ω–µ LIKE: `f.title LIKE %keyword%`.
            offset (int): –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ SQL –∫–∞–∫ `OFFSET`, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –ø–æ—Ä—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
                          –ù–∞–ø—Ä–∏–º–µ—Ä, offset=0 ‚Äî –ø–µ—Ä–≤—ã–µ 10 –∑–∞–ø–∏—Å–µ–π, offset=10 ‚Äî —Å–ª–µ–¥—É—é—â–∏–µ 10 –∏ —Ç.–¥.

        –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
            1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é `create_connection()`:
                - –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å (None), —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.

            2. –°–æ–∑–¥–∞—ë—Ç—Å—è –∫—É—Ä—Å–æ—Ä —Å –æ–ø—Ü–∏–µ–π `dictionary=True`,
               —á—Ç–æ–±—ã —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–ª–∏—Å—å –≤ —Å–ª–æ–≤–∞—Ä–∏ (dict), –∞ –Ω–µ –∫–æ—Ä—Ç–µ–∂–∏.

            3. SQL-–∑–∞–ø—Ä–æ—Å:
                - –í—ã–±–∏—Ä–∞–µ—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `film` –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è:
                    - `title`, `description`, `release_year`, `rating`
                - –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∂–∞–Ω—Ä—ã:
                    - –ß–µ—Ä–µ–∑ `GROUP_CONCAT(DISTINCT c.name)` ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∂–∞–Ω—Ä—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
                - –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –∏–º–µ–Ω–∞ –∞–∫—Ç—ë—Ä–æ–≤:
                    - –ß–µ—Ä–µ–∑ `GROUP_CONCAT(DISTINCT CONCAT(a.first_name, ' ', a.last_name))`
                - JOIN‚Äô—ã:
                    - `film_category`, `category`, `film_actor`, `actor` ‚Äî –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ –∂–∞–Ω—Ä–∞–º –∏ –∞–∫—Ç—ë—Ä–∞–º.
                - WHERE-—É—Å–ª–æ–≤–∏–µ:
                    - `f.title LIKE %keyword%` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫ –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏.
                - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:
                    - `GROUP BY f.film_id` ‚Äî –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–≥—Ä–µ–≥–∏—Ä—É—é—â–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏.
                - –ü–∞–≥–∏–Ω–∞—Ü–∏—è:
                    - `LIMIT 10 OFFSET {offset}` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (10 —à—Ç—É–∫).

            4. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `keyword` –∏ `offset` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `cursor.execute(...)` –∫–∞–∫ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã `%s`,
               —á—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π.

            5. –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
                - `cursor.fetchall()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π, –∫–∞–∂–¥—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω —Ñ–∏–ª—å–º –∏ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ.

            6. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ:
                - –û—à–∏–±–∫–∞ –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —á–µ—Ä–µ–∑ `print(...)`, –∏ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.

            7. –í –±–ª–æ–∫–µ finally:
                - –ó–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –∫—É—Ä—Å–æ—Ä –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, —á—Ç–æ–±—ã –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã.

        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
            {
                'title': str,
                'description': str,
                'release_year': int,
                'rating': str,
                'genre': str,         # –∂–∞–Ω—Ä—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: "Action, Comedy")
                'actors': str         # –∏–º–µ–Ω–∞ –∞–∫—Ç—ë—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: "Tom Hanks, Meg Ryan")
            }

        –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
            List[Dict[str, Any]]: –°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏—Ö —É—Å–ª–æ–≤–∏—è–º –ø–æ–∏—Å–∫–∞. –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è [].

        –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
            search_by_keyword("Matrix", offset=0)
            ‚Üí –≤–µ—Ä–Ω—ë—Ç —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–≤—ã—Ö 10 —Ñ–∏–ª—å–º–æ–≤, –≥–¥–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç "Matrix" (–±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞), —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∂–∞–Ω—Ä–∞–º–∏ –∏ –∞–∫—Ç—ë—Ä–∞–º–∏.
        """
    connection = create_connection()
    if not connection:
        return []

    try:
        cursor = connection.cursor(dictionary=True)
        query = """
            SELECT 
                f.title,
                f.description,
                f.release_year,
                f.rating,
                GROUP_CONCAT(DISTINCT c.name SEPARATOR ', ') AS genre,
                GROUP_CONCAT(DISTINCT CONCAT(a.first_name, ' ', a.last_name) SEPARATOR ', ') AS actors
            FROM film f
            LEFT JOIN film_category fc ON f.film_id = fc.film_id
            LEFT JOIN category c ON fc.category_id = c.category_id
            LEFT JOIN film_actor fa ON f.film_id = fa.film_id
            LEFT JOIN actor a ON fa.actor_id = a.actor_id
            WHERE f.title LIKE %s
            GROUP BY f.film_id
            LIMIT 10 OFFSET %s;
        """
        cursor.execute(query, (f"%{keyword}%", offset))
        return cursor.fetchall()
    except Error as e:
        print(f"[–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞]: {e}")
        return []
    finally:
        cursor.close()
        connection.close()


def get_year_range() -> Tuple[int, int]:
    """
        –ü–æ–ª—É—á–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≥–æ–¥ —Ä–µ–ª–∏–∑–∞ —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —Ñ–∏–ª—å–º–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö MySQL.

        –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
            –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ª–µ—Ç —Ä–µ–ª–∏–∑–∞ —Ñ–∏–ª—å–º–æ–≤,
            –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.

        –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
            1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `create_connection()`.
                - –ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: (1990, 2025).

            2. –°–æ–∑–¥–∞—ë—Ç—Å—è –∫—É—Ä—Å–æ—Ä –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è SQL-–∑–∞–ø—Ä–æ—Å:
                SELECT MIN(release_year), MAX(release_year) FROM film;

                - MIN(release_year): –Ω–∞—Ö–æ–¥–∏—Ç —Å–∞–º—ã–π —Ä–∞–Ω–Ω–∏–π –≥–æ–¥ –≤—ã—Ö–æ–¥–∞ —Ñ–∏–ª—å–º–∞.
                - MAX(release_year): –Ω–∞—Ö–æ–¥–∏—Ç —Å–∞–º—ã–π –ø–æ–∑–¥–Ω–∏–π –≥–æ–¥ –≤—ã—Ö–æ–¥–∞ —Ñ–∏–ª—å–º–∞.

            3. –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `cursor.fetchone()`:
                - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂ (min_year, max_year).
                - –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (None) ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

            4. –í —Å–ª—É—á–∞–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
                - –û—à–∏–±–∫–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.
                - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: (1990, 2025).

            5. –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –∫—É—Ä—Å–æ—Ä –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `finally`.

        –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
            Tuple[int, int]: –ö–æ—Ä—Ç–µ–∂ –∏–∑ –¥–≤—É—Ö —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª:
                - –ü–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≥–æ–¥ —Ä–µ–ª–∏–∑–∞ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ).
                - –í—Ç–æ—Ä–æ–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≥–æ–¥ —Ä–µ–ª–∏–∑–∞ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ).
                - –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: (1990, 2025) ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–µ.

        –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
            - –ó–Ω–∞—á–µ–Ω–∏—è —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞–±–ª–∏—Ü—ã `film`, –ø–æ–ª–µ `release_year`.
            - –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–µ–ª–µ–∫—Ç–æ—Ä–∞—Ö –≥–æ–¥–∞), —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–µ.
            - –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞–∂–µ –≤ —Å–ª—É—á–∞–µ —Å–±–æ–µ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î.

        –ü—Ä–∏–º–µ—Ä:
            year_min, year_max = get_year_range()
            ‚Üí (2001, 2022)
        """
    connection = create_connection()
    if not connection:
        return (1990, 2025)

    try:
        cursor = connection.cursor()
        cursor.execute("SELECT MIN(release_year), MAX(release_year) FROM film;")
        result = cursor.fetchone()
        return result if result else (1990, 2025)
    except Error as e:
        print(f"[–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞]: {e}")
        return (1990, 2025)
    finally:
        cursor.close()
        connection.close()


def get_genres() -> List[str]:
    """
        –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∂–∞–Ω—Ä–æ–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `category` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö MySQL, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É.

        –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
            –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—á–µ–Ω—å –∂–∞–Ω—Ä–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö,
            –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.

        –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
            1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ —á–µ—Ä–µ–∑ `create_connection()`.
                - –ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å (None), –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.

            2. –°–æ–∑–¥–∞—ë—Ç—Å—è –∫—É—Ä—Å–æ—Ä (–æ–±—ã—á–Ω—ã–π, –Ω–µ —Å–ª–æ–≤–∞—Ä–Ω—ã–π) –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è SQL-–∑–∞–ø—Ä–æ—Å:
                SELECT name FROM category ORDER BY name;
                - –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—è `name` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä–∞.
                - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `ORDER BY name` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫.

            3. –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `cursor.fetchall()`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π.
                - –ö–∞–∂–¥—ã–π –∫–æ—Ä—Ç–µ–∂ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –∏–º—è –∂–∞–Ω—Ä–∞.

            4. –°–ø–∏—Å–æ–∫ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ list comprehension:
                - `[row[0] for row in cursor.fetchall()]` ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–æ—Ä—Ç–µ–∂–µ–π –≤ —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫.

            5. –í —Å–ª—É—á–∞–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–±–æ–π –∑–∞–ø—Ä–æ—Å–∞ –∏–ª–∏ –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è):
                - –û—à–∏–±–∫–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.
                - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.

            6. –í –±–ª–æ–∫–µ finally:
                - –ö—É—Ä—Å–æ—Ä –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.

        –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
            List[str]: –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫, –∫–∞–∂–¥–∞—è ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä–∞, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É.
                       –ü—Ä–∏ –æ—à–∏–±–∫–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.

        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:
            ['Action', 'Comedy', 'Drama', 'Horror', 'Sci-Fi', ...]

        –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
            - –ù–µ —É–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã ‚Äî –µ—Å–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `category` –æ–Ω–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç, –æ–Ω–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ.
            - –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –∂–∞–Ω—Ä–∞–º–∏, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –≤ —Å–∞–º–æ–π —Ç–∞–±–ª–∏—Ü–µ `category`, –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ñ–∏–ª—å–º–∞—Ö.
            - –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `get_genres_with_ids`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏—è, –±–µ–∑ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤.

        –ü—Ä–∏–º–µ—Ä:
            genres = get_genres()
            ‚Üí ['Adventure', 'Animation', 'Biography', ...]
        """
    connection = create_connection()
    if not connection:
        return []

    try:
        cursor = connection.cursor()
        cursor.execute("SELECT name FROM category ORDER BY name;")
        return [row[0] for row in cursor.fetchall()]
    except Error as e:
        print(f"[–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞]: {e}")
        return []
    finally:
        cursor.close()
        connection.close()


def get_genres_with_ids() -> List[Dict[str, Any]]:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∂–∞–Ω—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö MySQL, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ñ–∏–ª—å–º–∞—Ö,
    –≤–∫–ª—é—á–∞—è –∏—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (category_id). –ñ–∞–Ω—Ä—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é.

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
        –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∂–∞–Ω—Ä–æ–≤, –ø—Ä–∏–≥–æ–¥–Ω—É—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å,
        –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–∞–∫ –∏–º—è –∂–∞–Ω—Ä–∞, —Ç–∞–∫ –∏ –µ–≥–æ ID ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –∏–ª–∏ API.

    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
        –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.

    –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
        1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `create_connection()`.
            –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.

        2. –°–æ–∑–¥–∞—ë—Ç—Å—è —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∫—É—Ä—Å–æ—Ä (dictionary=True), –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –≤–æ–∑–≤—Ä–∞—Ç —Å—Ç—Ä–æ–∫ –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä–µ–π.

        3. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è SQL-–∑–∞–ø—Ä–æ—Å:
            SELECT DISTINCT c.category_id, c.name
            FROM category c
            JOIN film_category fc ON c.category_id = fc.category_id
            GROUP BY c.category_id, c.name
            ORDER BY c.name;

            –î–µ—Ç–∞–ª–∏:
            - JOIN —Å —Ç–∞–±–ª–∏—Ü–µ–π `film_category` –∏—Å–∫–ª—é—á–∞–µ—Ç –∂–∞–Ω—Ä—ã, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –Ω–∏ —Å –æ–¥–Ω–∏–º —Ñ–∏–ª—å–º–æ–º.
            - DISTINCT + GROUP BY —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –ø–∞—Ä—ã (category_id, name).
            - ORDER BY —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –∏–º–µ–Ω–∏ –∂–∞–Ω—Ä–∞ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É.

        4. –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `cursor.fetchall()` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:
            {
                "category_id": int,
                "name": str
            }

        5. –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏:
            - –í—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.
            - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.

        6. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –∫—É—Ä—Å–æ—Ä –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –≤ –±–ª–æ–∫–µ `finally`.

    –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
        List[Dict[str, Any]]:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π, –∫–∞–∂–¥—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç:
                - 'category_id': —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∂–∞–Ω—Ä–∞;
                - 'name': –Ω–∞–∑–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä–∞.

    –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
        - –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `get_genres`, –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∂–∞–Ω—Ä—ã, –Ω–µ –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å —Ñ–∏–ª—å–º–∞–º–∏;
        - –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ ID –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º–∞—Ö, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –∂–∞–Ω—Ä—ã –≤ —Å–≤—è–∑–∞–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ;
        - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –¥–µ–ª–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º –∏ –ø—Ä–∏–≥–æ–¥–Ω—ã–º –¥–ª—è UI.

    –ü—Ä–∏–º–µ—Ä:
        [
            {"category_id": 3, "name": "Action"},
            {"category_id": 7, "name": "Comedy"},
            ...
        ]
    """
    connection = create_connection()
    if not connection:
        return []

    try:
        cursor = connection.cursor(dictionary=True)
        query = """
            SELECT DISTINCT c.category_id, c.name
            FROM category c
            JOIN film_category fc ON c.category_id = fc.category_id
            GROUP BY c.category_id, c.name
            ORDER BY c.name;
        """
        cursor.execute(query)
        return cursor.fetchall()
    except Error as e:
        print(f"[–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞]: {e}")
        return []
    finally:
        cursor.close()
        connection.close()


def search_by_genre_year(
    genres: List[str],
    year_from: int,
    year_to: int,
    offset: int = 0
) -> Dict[str, Any]:
    """
        –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤ –ø–æ –∂–∞–Ω—Ä–∞–º –∏ –¥–∏–∞–ø–∞–∑–æ–Ω—É –ª–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É—è –¥–≤–∞ SQL-–∑–∞–ø—Ä–æ—Å–∞:
        –æ–¥–∏–Ω –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π, –≤—Ç–æ—Ä–æ–π ‚Äî –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–æ—Ä—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.

        –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
            –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ñ–∏–ª—å–º–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∂–∞–Ω—Ä–∞–º –∏ –¥–∏–∞–ø–∞–∑–æ–Ω—É –ª–µ—Ç –≤—ã–ø—É—Å–∫–∞.
            –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø–æ–∏—Å–∫–∞, –≤–∫–ª—é—á–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.

        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            genres (List[str]): –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤, –ø–æ –∫–æ—Ç–æ—Ä—ã–º —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è —Ñ–∏–ª—å–º—ã. –ó–Ω–∞—á–µ–Ω–∏—è –æ—á–∏—â–∞—é—Ç—Å—è –æ—Ç –ø—Ä–æ–±–µ–ª–æ–≤.
            year_from (int): –ù–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ª–µ—Ç —Ä–µ–ª–∏–∑–∞ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ).
            year_to (int): –í–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ª–µ—Ç —Ä–µ–ª–∏–∑–∞ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ).
            offset (int): –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, offset=0 ‚Äî –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, offset=10 ‚Äî –≤—Ç–æ—Ä–∞—è –∏ —Ç.–¥.

        –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
            1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `create_connection()`.
                - –ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {"movies": [], "total_count": 0}.

            2. –°–æ–∑–¥–∞—ë—Ç —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∫—É—Ä—Å–æ—Ä (`dictionary=True`) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–∫ —Å–ª–æ–≤–∞—Ä–µ–π.

            3. –û—á–∏—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤:
                - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è `.strip()` –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É.
                - –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è.
                - –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫, –æ–±–∞ –∑–∞–ø—Ä–æ—Å–∞ –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è –ø—É—Å—Ç—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.

            4. –§–æ—Ä–º–∏—Ä—É–µ—Ç SQL-–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã:
                - `%s` —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∞–Ω—Ä–æ–≤: `'Sci-Fi', 'Action'` ‚Üí `(%s, %s)`

            5. –ü–æ–¥—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö —Ñ–∏–ª—å–º–æ–≤:
                - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π SQL-–∑–∞–ø—Ä–æ—Å (`count_query`) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞.
                - –£—Å–ª–æ–≤–∏—è:
                    - `category.name IN (%s, ...)`
                    - `release_year BETWEEN year_from AND year_to`
                - –ü–æ–¥—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `COUNT(*)` –≤–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ.

            6. –ü–æ–∏—Å–∫ —Å–ø–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤:
                - –í—Ç–æ—Ä–æ–π SQL-–∑–∞–ø—Ä–æ—Å (`film_query`) –≤—ã–±–∏—Ä–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —Ñ–∏–ª—å–º–∞–º:
                    - `title`, `description`, `release_year`, `rating`
                    - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∂–∞–Ω—Ä—ã —á–µ—Ä–µ–∑ `GROUP_CONCAT`
                    - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–∫—Ç—ë—Ä—ã —á–µ—Ä–µ–∑ `GROUP_CONCAT(CONCAT(...))`
                - JOIN‚Äô—ã:
                    - `film_category`, `category` (–¥–ª—è –∂–∞–Ω—Ä–æ–≤)
                    - `film_actor`, `actor` (–¥–ª—è –∞–∫—Ç—ë—Ä–æ–≤)
                - –£—Å–ª–æ–≤–∏—è:
                    - –ñ–∞–Ω—Ä—ã –≤ —Å–ø–∏—Å–∫–µ
                    - –ì–æ–¥—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
                - –ü–∞–≥–∏–Ω–∞—Ü–∏—è —á–µ—Ä–µ–∑ `LIMIT 10 OFFSET %s`.
                - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ `film_id` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≥—Ä–µ–≥–∏—Ä—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π.

            7. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
                - –°–Ω–∞—á–∞–ª–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è `total_count` –∏–∑ `count_query`.
                - –ó–∞—Ç–µ–º –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ –∏–∑ `film_query`.

            8. –û–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
                {
                    "movies": [...],       # –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ñ–∏–ª—å–º–∞—Ö
                    "total_count": int     # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                }

            9. –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ:
                - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ.
                - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è {"movies": [], "total_count": 0}.

            10. –í –±–ª–æ–∫–µ finally:
                - –ö—É—Ä—Å–æ—Ä –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é.

        –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
            Dict[str, Any]:
                - "movies": —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ —Å –ø–æ–ª—è–º–∏:
                    - title: str
                    - description: str
                    - release_year: int
                    - rating: str
                    - genre: str (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∂–∞–Ω—Ä—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
                    - actors: str (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–∫—Ç—ë—Ä—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
                - "total_count": –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö —Ñ–∏–ª—å–º–æ–≤ (int)

        –ü—Ä–∏–º–µ—Ä:
            result = search_by_genre_year(["Drama", "Comedy"], 2000, 2010, offset=20)
            ‚Üí result["movies"]: —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ —Å 3-–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            ‚Üí result["total_count"]: –æ–±—â–µ–µ —á–∏—Å–ª–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤ –∑–∞ 2000‚Äì2010
        """
    connection = create_connection()
    if not connection:
        return {"movies": [], "total_count": 0}

    try:
        cursor = connection.cursor(dictionary=True)
        genres_clean = [g.strip() for g in genres if g.strip()]
        genre_placeholder = ','.join(['%s'] * len(genres_clean))

        count_query = f'''
            SELECT COUNT(*) AS total FROM (
                SELECT f.film_id
                FROM film f
                JOIN film_category fc ON f.film_id = fc.film_id
                JOIN category c ON fc.category_id = c.category_id
                WHERE c.name IN ({genre_placeholder})
                AND f.release_year BETWEEN %s AND %s
                GROUP BY f.film_id
            ) AS subquery;
        '''
        cursor.execute(count_query, (*genres_clean, year_from, year_to))
        total_count = cursor.fetchone()["total"]

        film_query = f'''
            SELECT
                f.title,
                f.description,
                f.release_year,
                f.rating,
                GROUP_CONCAT(DISTINCT c.name SEPARATOR ', ') AS genre,
                GROUP_CONCAT(DISTINCT CONCAT(a.first_name, ' ', a.last_name) SEPARATOR ', ') AS actors
            FROM film f
            JOIN film_category fc ON f.film_id = fc.film_id
            JOIN category c ON fc.category_id = c.category_id
            LEFT JOIN film_actor fa ON f.film_id = fa.film_id
            LEFT JOIN actor a ON fa.actor_id = a.actor_id
            WHERE c.name IN ({genre_placeholder})
            AND f.release_year BETWEEN %s AND %s
            GROUP BY f.film_id
            LIMIT 10 OFFSET %s;
        '''
        cursor.execute(film_query, (*genres_clean, year_from, year_to, offset))
        movies = cursor.fetchall()

        return {
            "movies": movies,
            "total_count": total_count
        }

    except Error as e:
        print(f"[–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞]: {e}")
        return {"movies": [], "total_count": 0}
    finally:
        cursor.close()
        connection.close()


def search_by_genre_exact_year(
    genres: List[str],
    year: int,
    offset: int = 0
) -> Dict[str, Any]:
    """
        –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∂–∞–Ω—Ä–∞–º –∏ –æ–¥–Ω–æ–º—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≥–æ–¥—É,
        –≤–æ–∑–≤—Ä–∞—â–∞—è –∫–∞–∫ —Å–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —Ç–∞–∫ –∏ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.

        –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
            –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–æ—á–µ—á–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –ø–æ –∂–∞–Ω—Ä—É –∏ –≥–æ–¥—É –≤—ã–ø—É—Å–∫–∞.
            –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö, –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å —Ñ–∏–ª—å–º—ã, –≤—ã—à–µ–¥—à–∏–µ —Å—Ç—Ä–æ–≥–æ –≤ –∑–∞–¥–∞–Ω–Ω—ã–π –≥–æ–¥, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –∑–∞–¥–∞–Ω–Ω—ã–º –∂–∞–Ω—Ä–∞–º.

        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            genres (List[str]): –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏. –≠–ª–µ–º–µ–Ω—Ç—ã –æ—á–∏—â–∞—é—Ç—Å—è –æ—Ç –ø—Ä–æ–±–µ–ª–æ–≤; –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è.
            year (int): –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ —Ñ–∏–ª—å–º–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1999).
            offset (int): –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ SQL-—É—Å–ª–æ–≤–∏–∏ OFFSET, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

        –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
            1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `create_connection()`.
               –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è {"movies": [], "total_count": 0}.

            2. –°–æ–∑–¥–∞—ë—Ç—Å—è —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∫—É—Ä—Å–æ—Ä (`dictionary=True`) –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π.

            3. –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
                - –ñ–∞–Ω—Ä—ã –æ—á–∏—â–∞—é—Ç—Å—è –∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è. –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç ‚Äî –∑–∞–ø—Ä–æ—Å –≤—Å—ë —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω, –Ω–æ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
                - –§–æ—Ä–º–∏—Ä—É—é—Ç—Å—è SQL-–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã `%s` –¥–ª—è –≤—Å–µ—Ö –∂–∞–Ω—Ä–æ–≤: 'Action', 'Drama' ‚Üí (%s, %s)

            4. –ü–µ—Ä–≤—ã–π SQL-–∑–∞–ø—Ä–æ—Å (`count_query`) –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–¥—Å—á—ë—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π:
                - –ü–æ–∏—Å–∫ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º `film`, `film_category`, `category`
                - –£—Å–ª–æ–≤–∏–µ: `c.name IN (...)` –∏ `f.release_year = year`
                - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å `GROUP BY film_id`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.

            5. –í—Ç–æ—Ä–æ–π SQL-–∑–∞–ø—Ä–æ—Å (`film_query`) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ñ–∏–ª—å–º–∞—Ö:
                - –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –ø–æ–ª—è: title, description, release_year, rating
                - –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∂–∞–Ω—Ä—ã —á–µ—Ä–µ–∑ `GROUP_CONCAT(DISTINCT c.name)`
                - –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–∫—Ç—ë—Ä—ã —á–µ—Ä–µ–∑ `GROUP_CONCAT(DISTINCT CONCAT(...))`
                - JOIN‚Äô—ã —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∞–∫—Ç—ë—Ä–æ–≤ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ `film_id` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
                - –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `LIMIT 10 OFFSET %s`

            6. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
                - –°–Ω–∞—á–∞–ª–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è `total_count` –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞;
                - –ó–∞—Ç–µ–º –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ –∏–∑ –≤—Ç–æ—Ä–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

            7. –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è:
                {
                    "movies": [...],       # —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ —Ñ–∏–ª—å–º–∞–º
                    "total_count": int     # –æ–±—â–µ–µ —á–∏—Å–ª–æ —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
                }

            8. –í —Å–ª—É—á–∞–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π:
                - –ü–µ—á–∞—Ç–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.
                - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è {"movies": [], "total_count": 0}.

            9. –í –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –∫—É—Ä—Å–æ—Ä –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ –±–ª–æ–∫–µ `finally`.

        –§–æ—Ä–º–∞—Ç –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
            {
                "title": str,
                "description": str,
                "release_year": int,
                "rating": str,
                "genre": str,       # —Å—Ç—Ä–æ–∫–∞ –∂–∞–Ω—Ä–æ–≤, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø—è—Ç–æ–π
                "actors": str       # —Å—Ç—Ä–æ–∫–∞ –∏–º—ë–Ω –∞–∫—Ç—ë—Ä–æ–≤, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø—è—Ç–æ–π
            }

        –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
            Dict[str, Any]: –°–ª–æ–≤–∞—Ä—å —Å –¥–≤—É–º—è –∫–ª—é—á–∞–º–∏:
                - "movies": —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ (–¥–æ 10 –∑–∞–ø–∏—Å–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç offset)
                - "total_count": –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ñ–∏–ª—å–º–æ–≤

        –ü—Ä–∏–º–µ—Ä:
            result = search_by_genre_exact_year(['Drama', 'Thriller'], 1999)
            ‚Üí result["movies"]: —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ 1999 –≥–æ–¥–∞ –ø–æ —ç—Ç–∏–º –∂–∞–Ω—Ä–∞–º
            ‚Üí result["total_count"]: —á–∏—Å–ª–æ –≤—Å–µ—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ —ç—Ç–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        """
    connection = create_connection()
    if not connection:
        return {"movies": [], "total_count": 0}

    try:
        cursor = connection.cursor(dictionary=True)
        genres_clean = [g.strip() for g in genres if g.strip()]
        genre_placeholder = ','.join(['%s'] * len(genres_clean))

        count_query = f'''
            SELECT COUNT(*) AS total FROM (
                SELECT f.film_id
                FROM film f
                JOIN film_category fc ON f.film_id = fc.film_id
                JOIN category c ON fc.category_id = c.category_id
                WHERE c.name IN ({genre_placeholder})
                AND f.release_year = %s
                GROUP BY f.film_id
            ) AS subquery;
        '''
        cursor.execute(count_query, (*genres_clean, year))
        total_count = cursor.fetchone()["total"]

        film_query = f'''
            SELECT
                f.title,
                f.description,
                f.release_year,
                f.rating,
                GROUP_CONCAT(DISTINCT c.name SEPARATOR ', ') AS genre,
                GROUP_CONCAT(DISTINCT CONCAT(a.first_name, ' ', a.last_name) SEPARATOR ', ') AS actors
            FROM film f
            JOIN film_category fc ON f.film_id = fc.film_id
            JOIN category c ON fc.category_id = c.category_id
            LEFT JOIN film_actor fa ON f.film_id = fa.film_id
            LEFT JOIN actor a ON fa.actor_id = a.actor_id
            WHERE c.name IN ({genre_placeholder})
            AND f.release_year = %s
            GROUP BY f.film_id
            LIMIT 10 OFFSET %s;
        '''
        cursor.execute(film_query, (*genres_clean, year, offset))
        movies = cursor.fetchall()

        return {
            "movies": movies,
            "total_count": total_count
        }

    except Error as e:
        print(f"[–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞]: {e}")
        return {"movies": [], "total_count": 0}
    finally:
        cursor.close()
        connection.close()
