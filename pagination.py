from typing import Callable
from input_utils import prompt_next_page
from visualizer import loading_animation, celebrate
from formatter import format_movies_table


def paginate_results(
    fetch_function: Callable[..., list],
    fetch_args: tuple,
    start_offset: int = 0,
    label: str = "–§–∏–ª—å–º—ã"
) -> None:
    """
        –ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.

        –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
            –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–≤–æ–¥ –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º.
            –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –≥–¥–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ 10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            fetch_function (Callable[..., list]): –§—É–Ω–∫—Ü–∏—è, –∏–∑–≤–ª–µ–∫–∞—é—â–∞—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –î–æ–ª–∂–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å offset –∫–∞–∫ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç.
            fetch_args (tuple): –ê—Ä–≥—É–º–µ–Ω—Ç—ã, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –≤ fetch_function, –∫—Ä–æ–º–µ offset.
            start_offset (int): –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.
            label (str): –ù–∞–∑–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–§–∏–ª—å–º—ã"), –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

        –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
            1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `offset`, –Ω–∞—á–∏–Ω–∞—è —Å–æ `start_offset`.
            2. –í –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ:
                - –ü–æ–∫–∞–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å `loading_animation(...)`.
                - –í—ã–∑–æ–≤ `fetch_function(*fetch_args, offset=offset)`.
                - –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ—Ç:
                    ‚Ä¢ –ï—Å–ª–∏ `offset == 0`, –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ".
                    ‚Ä¢ –ò–Ω–∞—á–µ ‚Äî "–ë–æ–ª—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ—Ç".
                    ‚Ä¢ –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
                - –ò–Ω–∞—á–µ:
                    ‚Ä¢ –†–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã: `offset // 10 + 1`.
                    ‚Ä¢ –ü–µ—á–∞—Ç–∞–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –Ω–æ–º–µ—Ä–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
                    ‚Ä¢ –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ç–∞–±–ª–∏—á–Ω–æ–π —Ñ–æ—Ä–º–µ —á–µ—Ä–µ–∑ `format_movies_table`.
                    ‚Ä¢ –ü—Ä–∞–∑–¥–Ω–∏—á–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Å `celebrate()`.
                    ‚Ä¢ –í—ã–∑–æ–≤ `prompt_next_page()`.
                    ‚Ä¢ –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç ‚Äî –Ω–µ `"y"`, —Ü–∏–∫–ª –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
                    ‚Ä¢ –ò–Ω–∞—á–µ `offset += 10`, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.

        –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
            - –§—É–Ω–∫—Ü–∏—è `fetch_function` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –∞—Ä–≥—É–º–µ–Ω—Ç–∞ `offset`.
            - –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–ª–∏–Ω–æ–π –¥–æ 10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–∏–ª–∏ –º–µ–Ω—å—à–µ).
            - –í—ã–≤–æ–¥ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å, –±–µ–∑ GUI-—ç–ª–µ–º–µ–Ω—Ç–æ–≤.

        –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:
            - –ü–µ—á–∞—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ stdout.
            - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `prompt_next_page`.

        –ü—Ä–∏–º–µ—Ä:
            paginate_results(fetch_function=search_by_genre_exact_year, fetch_args=(["Drama"], 2001))
            ‚Üí –ü–æ—à–∞–≥–æ–≤—ã–π –≤—ã–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü —Å —Ñ–∏–ª—å–º–∞–º–∏ 2001 –≥–æ–¥–∞ –≤ –∂–∞–Ω—Ä–µ Drama.

        –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
            None. –í—ã–≤–æ–¥ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ stdout.
        """
    offset = start_offset

    while True:
        loading_animation(f"–ò—â–µ–º {label.lower()}")
        results = fetch_function(*fetch_args, offset=offset)

        if not results:
            msg = "üò¢ –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ." if offset == 0 else "üì≠ –ë–æ–ª—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ—Ç."
            print(f"\n{msg}\n")
            break

        page_num = offset // 10 + 1
        header = f"\nüì¶ –ù–∞–π–¥–µ–Ω–æ: {len(results)} {label.lower()} (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ {page_num})\n"
        print(header)

        format_movies_table(results)
        celebrate()

        if prompt_next_page() != "y":
            break
        offset += 10
